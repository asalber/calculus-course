\begingroup \toks 0={macro:->[/pgf/declare function={f=x^3-6*x^2+11*x-3;}, trim axis left, trim axis right] \begin {axis}[ gen2dfun, xmin=0, xmax=4, ymin=0, ymax=4, xtick={1,3}, xticklabels={$a$,$b$}, ytick={}, yticklabels={}, clip=false, width=4cm, ] \addplot +[domain=0.7:3.3, samples=100, smooth, name path=F] {f} node[anchor=south] {$f(x)$}; \draw [decorate, decoration={brace, amplitude=4pt}] (1,0) -- (1,3) node [midway, left, xshift=-2pt] {$f(x_i)$}; \addplot [ybar interval, color1, fill=color1, opacity=0.3, domain=1:3, samples=5] {f}; \draw [decorate, decoration={brace, amplitude=3pt, mirror}] (1,0) -- (1.5,0) node [midway, below, yshift=-2pt] {$\Delta x$}; \end {axis} }\xdef \tikzexternallastkey {\the \toks 0 }\endgroup %
